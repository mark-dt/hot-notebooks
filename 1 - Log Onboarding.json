{"version":"5","defaultTimeframe":{"from":"now-1h","to":"now","details":{"from":{"type":"expression","normalized":"now-1h","date":"2023-10-03T13:47:17.717Z"},"to":{"type":"expression","normalized":"now","date":"2023-10-03T14:47:17.717Z"}}},"sections":[{"id":"acb1fac0-c861-495a-a7dc-01cb2ef64df7","type":"markdown","markdown":"# Log Onboard Lab\n\nIn this lab, we are going to onboard logs from an application. \n\nThis is not a usual application, but an application specifically designed to train & test your skills.\n\nIn this lab, we will have the following two parts:\n\nLog Ingestion (25 min):\n* Onboard auto-detected logs\n* Onboard logs by changing OneAgent security rules\n* Onboard logs from an invisible process (custom log source)\n\nSome log data is already being sent to Dynatrace through an API, the rest we will onboard ourselves using the VM."},{"id":"1f3d5ce2-0969-4d5f-8d37-8e40b1eb851a","type":"dql","showTitle":false,"davisAnalysis":{"analyzerComponentState":{"resultState":{}}},"title":"0. Check VM if this is empty","state":{"input":{"value":"fetch logs\n| filter log.source == \"Api-Ingested\"\n| summarize count(), by:{log.source}","timeframe":{"from":"now-2h","to":"now"}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","isBackgroundThresholdActive":false},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true},"isDavisVisualizationAvailable":true}}},{"id":"68335300-80be-4e99-b211-612758c80351","type":"markdown","markdown":"### Log Ingestion Lab - 3 exercises"},{"id":"59a5175b-abf4-4921-8604-76a701067343","type":"markdown","markdown":"##### 1. Onboard Auto-detected logs (10 min)\n\nGo ahead and onboard the following auto-detected logs: \n* /var/log/loglab/output.log\n* /var/log/loglab/error.log\n* /var/log/loglab/warning.log\n* /var/log/loglab/access.log\n\nThere are different ways to Rome here - consider whether you want to do this:\n* environment-wide\n* host-group-wide\n* or limited to the host.\nAlso consider if you want to include the entire directory, e.g. /var/log/loglab/* or if you want to have specific files instead.\n\nUse the below query to validate that you have onboarded all desired log files. If there are no Api-Ingested logs, something is broken, check your vm."},{"id":"ca56e3af-a5a9-4f8e-9746-4a1a7e8e09f9","type":"dql","showTitle":false,"state":{"input":{"value":"fetch logs\n| filter startsWith(log.source,\"/var/log/loglab/\")\n| summarize count = count(), by:{log.source}","timeframe":{"from":"now-30m","to":"now","details":{"from":{"type":"expression","normalized":"now-30m","date":"2023-10-03T11:14:41.327Z"},"to":{"type":"expression","normalized":"now","date":"2023-10-03T11:44:41.327Z"}}}},"davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true},"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","isBackgroundThresholdActive":false},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"firstVisibleRowIndex":0,"columnWidths":{}}}},"title":"1. Check that you have successfully onboarded above logs"},{"id":"ea7ae861-cdeb-44a5-bf3d-2f025f299f8a","type":"markdown","markdown":"##### 2. Onboard logs from an invisible process (5 min)\n\nWe have a small batch job running that writes to a log every minute and immediately shuts down.\nThe OneAgent doesn't detect this process, and marking it as important will also not work (since it just does a cat to a file)\n\nThe file is:\n* /var/log/fastwrite/output.log\n\nYou need to:\n* Create a custom log source rule (Again think of the scope: Environment / Host Group / Host)\n* Create a storage rule to ingest the file"},{"id":"faed0cb3-1128-4375-9136-fbb90d5efa55","type":"dql","showTitle":false,"state":{"input":{"value":"fetch logs\n| filter log.source == \"/var/log/fastwrite/output.log\"","timeframe":{"from":"now-30m","to":"now","details":{"from":{"type":"expression","normalized":"now-30m","date":"2023-10-03T11:14:41.327Z"},"to":{"type":"expression","normalized":"now","date":"2023-10-03T11:44:41.327Z"}}}},"davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true},"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","isBackgroundThresholdActive":false},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"firstVisibleRowIndex":0,"columnWidths":{}}}},"title":"2. Confirm that you see the logs from the invisible process"},{"id":"48a4115e-992d-476c-96f9-85235c08b77a","type":"markdown","markdown":"##### 3. Onboard logs by changing OneAgent security rules (10min, difficult)\n\nWe have a log file that is unfortunately in a directory that the OneAgent doesn't recognize as a log file.\nThe file is:\n* /tmp/logLabOutput\n\nYou neaed to create:\n* A security rule override\n* A custom log monitoring rule\n* A rule to ingest this log file\n\nThe json for the security rule override is here.\n\nCreate a file called `logconfig.json` inside this directory `/var/lib/dynatrace/oneagent/agent/config/logmodule/` and use the below for the contents.\nIt is automatically applied after saving, no need to restart anything\n\n```\n{\n  \"allowed-log-paths-configuration\": [\n    {\n      \"directory-pattern\": \"/home/ace\",\n      \"file-pattern\": \"logLabOutput\",\n      \"action\": \"INCLUDE\"\n    }\n  ]\n} \n```\n\nDon't forget to use **sudo -s** before creating the file.\n\n---\nIn the real world:\n* The Filename doesn't matter\n* We (Dynatrace) can set these rules environment wide at your request if required."},{"id":"8e6f6ce6-1342-4e56-81f6-8bb5c72d4e53","type":"dql","showTitle":false,"state":{"input":{"value":"fetch logs\n| filter log.source == \"/home/ace/logLabOutput\"","timeframe":{"from":"now-2h","to":"now"}},"davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true},"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","isBackgroundThresholdActive":false},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"firstVisibleRowIndex":0,"columnWidths":{}}}},"title":"3. Confirm that you see the logs from the unrecognized log file"}]}
